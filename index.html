<!DOCTYPE html>
<html lang="en" data-scheme="professional" data-mode="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Branestawm - Your AI Chief of Staff</title>
    
    <!-- Glooper Design System - Lexend Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Modular CSS stylesheets -->
    <link rel="stylesheet" href="tokens.css">
    <link rel="stylesheet" href="layout.css">
    <link rel="stylesheet" href="components.css">
    <link rel="stylesheet" href="chat.css">
    <link rel="stylesheet" href="themes.css">
</head>
<body>
    <!-- Skip link for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <div class="container">
        <header class="header" role="banner">
            <div class="header-left">
                <h1>Branestawm</h1>
                <div class="header-subtitle">Your indispensable AI Chief of Staff</div>
            </div>
            <div class="header-controls">
                <div class="tooltip">
                    <button class="btn icon-btn" id="webSearchBtn" aria-label="Open web search options">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                            <path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/>
                        </svg>
                    </button>
                    <div class="tooltip-content">Web search with Google AI & Perplexity</div>
                </div>
                
                <div class="tooltip">
                    <button class="btn icon-btn" id="settingsBtn" aria-label="Open settings">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                            <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.82,11.69,4.82,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
                        </svg>
                    </button>
                    <div class="tooltip-content">Open settings</div>
                </div>
                
                <div class="tooltip">
                    <button class="btn icon-btn" id="syncBtn" aria-label="Sync your data to cloud">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                            <path d="M12,18.17L8.83,15L7.42,16.41L12,21L16.58,16.41L15.17,15M12,5.83L15.17,9L16.58,7.59L12,3L7.42,7.59L8.83,9L12,5.83Z"/>
                        </svg>
                    </button>
                    <div class="tooltip-content">Sync your data to cloud</div>
                </div>
                
            </div>
        </header>

        <main class="main-content" id="main-content">
            <aside class="sidebar" role="complementary" aria-label="Folios">
                <!-- Folios Header - Always at top -->
                <div class="canvas-header">
                    <h3>Folios</h3>
                    <div class="canvas-actions">
                        <div class="tooltip">
                            <button class="btn small" id="newFolioBtn" aria-label="Create a new folio">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"/>
                                </svg>
                            </button>
                            <div class="tooltip-content">Create a new folio</div>
                        </div>
                        <div class="tooltip">
                            <button class="btn small secondary" id="browseFoliosBtn" aria-label="Search your collection of folios">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M15.5,14L20.5,19L19,20.5L14,15.5V14.71L13.73,14.43C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.43,13.73L14.71,14H15.5M9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14Z"/>
                                </svg>
                            </button>
                            <div class="tooltip-content">Search your collection of folios</div>
                        </div>
                    </div>
                </div>

                <!-- Pinned Folios Section -->
                <div class="sidebar-section pinned-section" id="pinnedSection" style="display: none;">
                    <div class="section-subheader">
                        <h4 class="section-subtitle">Pinned</h4>
                    </div>
                    <div class="pinned-folios-list" id="pinnedFoliosList" role="list" aria-label="Pinned folios">
                        <!-- Pinned folios will be populated here -->
                    </div>
                </div>

                <!-- Recent Folios Section -->
                <div class="sidebar-section">
                    <div class="section-subheader">
                        <h4 class="section-subtitle">Recent</h4>
                    </div>
                    <div class="recent-folios-list" id="recentFoliosList" role="list" aria-label="Recent folios">
                        <!-- Recent folios will be populated here -->
                    </div>
                </div>
            </aside>

            <section class="chat-container" role="main" aria-label="Chat conversation">
                <div class="chat-messages" id="chatMessages" role="log" aria-live="polite" aria-label="Chat messages">
                    <div class="message system" role="status">
                        <strong>Welcome to Branestawm!</strong> Your indispensable AI Chief of Staff is here to provide cognitive support and help with executive function challenges.
                        <br><br>
                        <strong>I'm designed to help you:</strong><br>
                        • Break down complex tasks into manageable steps<br>
                        • Organize thoughts and create structured plans<br>
                        • Provide patient, supportive guidance<br>
                        • Search the web when you need current information<br>
                        <br>
                        <strong>Getting Started:</strong><br>
                        • If you haven't set up yet, I'll guide you through the simple process<br>
                        • Use the Import button on Google AI Mode for web search<br>
                        • Generate documents from our conversations<br>
                        <br>
                        <em>Designed as a cognitive prosthetic to support neurodivergent users with executive function challenges.</em>
                    </div>
                </div>
                <div class="chat-input">
                    <div class="connection-warning" id="connectionWarning" style="display: none;">
                        <div class="warning-content">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="warning-icon">
                                <path d="M12,2L13.09,8.26L22,9L13.09,9.74L12,16L10.91,9.74L2,9L10.91,8.26L12,2M12,21A1.5,1.5 0 0,0 13.5,19.5A1.5,1.5 0 0,0 12,18A1.5,1.5 0 0,0 10.5,19.5A1.5,1.5 0 0,0 12,21Z"/>
                            </svg>
                            <div class="warning-text">
                                <strong>AI Connection Required</strong>
                                <p>You need to set up your AI connection to start chatting. Choose your preferred method:</p>
                                <div class="warning-actions">
                                    <button class="btn small" id="warningGoogleSignIn">Sign in with Google</button>
                                    <button class="btn small secondary" id="warningAdvancedSetup">Advanced Setup</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="input-container">
                        <label for="messageInput" class="sr-only">Message input</label>
                        <textarea 
                            class="message-input" 
                            id="messageInput" 
                            placeholder="Continue your dialogue with Branestawm..."
                            aria-label="Type your message here"
                            rows="3"
                        ></textarea>
                        <div class="tooltip">
                            <button class="btn send-btn" id="sendBtn" aria-label="Send message">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                                    <path d="M2,21L23,12L2,3V10L17,12L2,14V21Z"/>
                                </svg>
                                <span class="sr-only">Send (Press Enter)</span>
                            </button>
                            <div class="tooltip-content">Send message (Enter)</div>
                        </div>
                    </div>
                </div>
            </section>

            <aside class="artifact-canvas" role="complementary" aria-label="Dynamic document canvas">
                <div class="canvas-header">
                    <h3>Artifact Canvas</h3>
                    <div class="canvas-actions">
                        <div class="tooltip">
                            <button class="btn small" id="generateArtifactBtn" aria-label="Generate document from dialogue">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M19,19H5V5H19V19Z"/>
                                    <path d="M16.5,16.25L16.5,14.75L15,14.75L15,16.25L13.5,16.25L13.5,17.75L15,17.75L15,19.25L16.5,19.25L16.5,17.75L18,17.75L18,16.25L16.5,16.25Z"/>
                                </svg>
                            </button>
                            <div class="tooltip-content">Generate document from current dialogue</div>
                        </div>
                        <div class="tooltip">
                            <button class="btn small secondary" id="newArtifactBtn" aria-label="Create a new document">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                                </svg>
                            </button>
                            <div class="tooltip-content">Create a new document</div>
                        </div>
                    </div>
                </div>
                <div class="canvas-content" id="canvasContent">
                    <div class="canvas-empty" id="canvasEmpty">
                        <div class="canvas-empty-icon">🎨</div>
                        <div class="canvas-empty-text">Dynamic Canvas</div>
                        <div class="canvas-empty-description">
                            Create and edit documents on the fly. Generate artifacts from your dialogue or start with a blank template.
                        </div>
                    </div>
                </div>
            </aside>
        </main>
    </div>

    <!-- Setup Modal for New Users -->
    <div class="modal" id="setupModal" role="dialog" aria-labelledby="setupModalTitle" aria-modal="true">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="setupModalTitle">Welcome to Branestawm</h3>
                <button class="close-btn" aria-label="Close setup modal">×</button>
            </div>
            <div class="setup-intro">
                <p>Choose how you'd like to connect to AI services. We recommend the <strong>Easy Setup</strong> for most users.</p>
            </div>
            
            <div class="setup-options">
                <div class="setup-option" id="easySetupOption" tabindex="0" role="button" aria-describedby="easySetupDesc">
                    <div class="setup-option-content">
                        <div class="setup-option-text">
                            <h4>Easy Setup</h4>
                            <div class="badge">Recommended</div>
                            <p id="easySetupDesc">Sign in with Google to use Gemini 1.5 Flash. Get 1,500 free requests per day with zero configuration.</p>
                        </div>
                        <div class="setup-option-button">
                            <button class="btn" id="googleAuthBtn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                                    <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                    <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                    <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                    <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                                </svg>
                                Sign in with Google
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="setup-option" id="advancedSetupOption" tabindex="0" role="button" aria-describedby="advancedSetupDesc">
                    <div class="setup-option-content">
                        <div class="setup-option-text">
                            <h4>Advanced Setup</h4>
                            <div class="badge-spacer"></div>
                            <p id="advancedSetupDesc">Use your own API key with providers like Cerebras (free), OpenAI, OpenRouter, or custom endpoints.</p>
                        </div>
                        <div class="setup-option-button">
                            <button class="btn secondary" id="advancedSetupBtn">Configure API Key</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="setup-footer">
                <p class="help-text">
                    <strong>Privacy:</strong> Your conversations are stored locally on your device. 
                    Cloud sync is optional and uses military-grade encryption.
                </p>
                <p class="help-text" style="margin-top: var(--space-3); font-size: var(--font-size-xs); color: var(--text-tertiary);">
                    <strong>Note:</strong> Google sign-in is currently limited to authorized test users during development.
                </p>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal" role="dialog" aria-labelledby="settingsModalTitle" aria-modal="true">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="settingsModalTitle">Settings</h3>
                <button class="close-btn" aria-label="Close settings modal">×</button>
            </div>
            <div id="settingsContent">
                <!-- Settings content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div class="modal" id="exportModal" role="dialog" aria-labelledby="exportModalTitle" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="exportModalTitle">Export Data</h3>
                <button class="close-btn" aria-label="Close export modal">×</button>
            </div>
            <div id="exportContent">
                <p class="help-text">Choose what you'd like to export as markdown files:</p>
                <div class="export-options">
                    <button class="btn" id="exportCurrentBtn">Export Current Conversation</button>
                    <button class="btn" id="exportAllBtn">Export All Data</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Folio Modal -->
    <div class="modal" id="folioModal" role="dialog" aria-labelledby="folioModalTitle" aria-modal="true">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="folioModalTitle">New Folio</h3>
                <button class="close-btn" aria-label="Close folio modal">×</button>
            </div>
            <div class="modal-body" id="folioContent">
                <div class="form-group">
                    <label for="folioTitle" class="label label-required">Folio Title</label>
                    <input type="text" id="folioTitle" class="input" placeholder="Enter folio title" required>
                    <div class="help-text">Choose a descriptive title for your folio</div>
                </div>
                <div class="form-group">
                    <label for="folioDescription" class="label">Description</label>
                    <textarea id="folioDescription" class="input" placeholder="Optional description" rows="3"></textarea>
                    <div class="help-text">Briefly describe what this folio is for</div>
                </div>
                <div class="form-group">
                    <label for="folioPersona" class="label label-required">Assigned Persona</label>
                    <select id="folioPersona" class="input" required>
                        <option value="core">Core Persona - General assistance and cognitive support</option>
                        <!-- Additional personas will be populated dynamically -->
                    </select>
                    <div class="help-text">Select the persona that will handle conversations in this folio</div>
                </div>
                <div class="form-group">
                    <label for="folioGuidelines" class="label">Custom Guidelines</label>
                    <textarea id="folioGuidelines" class="input" placeholder="Enter custom guidelines for this folio..." rows="4"></textarea>
                    <div class="help-text">These guidelines will guide how the assigned persona behaves in this folio. For example: "Focus on technical accuracy", "Use a formal tone", "Emphasize creative solutions", etc.</div>
                </div>
                <div class="form-actions">
                    <button class="btn secondary" id="cancelFolioBtn">Cancel</button>
                    <button class="btn" id="createFolioBtn">Create Folio</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Artifact Modal -->
    <div class="modal" id="artifactModal" role="dialog" aria-labelledby="artifactModalTitle" aria-modal="true">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="artifactModalTitle">Edit Note</h3>
                <button class="close-btn" aria-label="Close note modal">×</button>
            </div>
            <div id="artifactContent">
                <div class="form-group">
                    <label for="artifactTitle" class="label label-required">Note Title</label>
                    <input type="text" id="artifactTitle" class="input" placeholder="Enter note title" required>
                </div>
                <div class="form-group">
                    <label for="artifactText" class="label">Content</label>
                    <textarea id="artifactText" class="input" placeholder="Write your note in markdown..." rows="10"></textarea>
                    <div class="help-text">You can use markdown formatting</div>
                </div>
                <div class="form-actions">
                    <button class="btn secondary" id="cancelArtifactBtn">Cancel</button>
                    <button class="btn" id="saveArtifactBtn">Save Note</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Folio Selection Modal -->
    <div class="modal" id="folioSelectionModal" role="dialog" aria-labelledby="folioSelectionModalTitle" aria-modal="true">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="folioSelectionModalTitle">Select Folio</h3>
                <button class="close-btn" aria-label="Close folio selection modal">×</button>
            </div>
            <div class="modal-body">
                <div class="search-box">
                    <input type="text" id="folioSearchInput" class="input" placeholder="Search folios..." aria-label="Search folios">
                </div>
                <div class="folios-grid" id="foliosGrid">
                    <!-- Folios will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Conversation Selection Modal -->
    <div class="modal" id="conversationSelectionModal" role="dialog" aria-labelledby="conversationSelectionModalTitle" aria-modal="true">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="conversationSelectionModalTitle">Browse Conversations</h3>
                <button class="close-btn" aria-label="Close conversation selection modal">×</button>
            </div>
            <div class="modal-body">
                <div class="search-box">
                    <input type="text" id="conversationSearchInput" class="input" placeholder="Search conversations..." aria-label="Search conversations">
                </div>
                <div class="conversations-grid" id="conversationsGrid">
                    <!-- Conversations will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Conversation Modal -->
    <div class="modal" id="editConversationModal" role="dialog" aria-labelledby="editConversationModalTitle" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="editConversationModalTitle">Edit Conversation</h3>
                <button class="close-btn" aria-label="Close edit conversation modal">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="conversationTitle" class="label label-required">Title</label>
                    <input type="text" id="conversationTitle" class="input" placeholder="Enter conversation title" required>
                </div>
                <div class="form-group">
                    <label for="conversationDescription" class="label">Description</label>
                    <textarea id="conversationDescription" class="input" placeholder="Optional description" rows="3"></textarea>
                    <div class="help-text">Briefly describe what this conversation is about</div>
                </div>
                <div class="form-actions">
                    <button class="btn secondary" id="cancelEditConversationBtn">Cancel</button>
                    <button class="btn" id="saveConversationBtn">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal" id="deleteConfirmationModal" role="dialog" aria-labelledby="deleteConfirmationModalTitle" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="deleteConfirmationModalTitle">Confirm Deletion</h3>
                <button class="close-btn" aria-label="Close delete confirmation modal">×</button>
            </div>
            <div class="modal-body">
                <div class="delete-warning">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor" class="warning-icon">
                        <path d="M12,2L13.09,8.26L22,9L13.09,9.74L12,16L10.91,9.74L2,9L10.91,8.26L12,2Z"/>
                    </svg>
                    <p id="deleteMessage">Are you sure you want to delete this item? This action cannot be undone.</p>
                </div>
                <div class="form-actions">
                    <button class="btn secondary" id="cancelDeleteBtn">Cancel</button>
                    <button class="btn danger" id="confirmDeleteBtn">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Web Search Modal -->
    <div class="modal" id="webSearchModal" role="dialog" aria-labelledby="webSearchModalTitle" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title-with-info">
                    <h3 id="webSearchModalTitle">Web Search Options</h3>
                    <button class="option-info-btn" id="webSearchInfoBtn" aria-label="How it works">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M11,7H13V9H11V7M11,11H13V17H11V11Z"/>
                        </svg>
                    </button>
                    <div class="main-info-tooltip" id="webSearchInfoTooltip">
                        <ol>
                            <li>Click a search option to open that platform in a new tab</li>
                            <li>Perform your search using the familiar interface</li>
                            <li>Look for the "Import to Branestawm" button on the search results</li>
                            <li>Click import to bring the AI response into your current conversation</li>
                        </ol>
                    </div>
                </div>
                <button class="close-btn" aria-label="Close web search modal">×</button>
            </div>
            <div class="modal-body">
                <div class="web-search-options">
                    <div class="search-option">
                        <div class="search-option-header">
                            <div class="search-option-title">
                                <h4>Google</h4>
                                <button class="option-info-btn" id="googleInfoBtn" aria-label="Google search information">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M11,7H13V9H11V7M11,11H13V17H11V11Z"/>
                                    </svg>
                                </button>
                                <div class="option-info-tooltip" id="googleInfoTooltip">
                                    Opens Google with AI Overview enabled. Import AI summaries, featured snippets, or knowledge panel content
                                </div>
                            </div>
                        </div>
                        <button class="btn" id="searchGoogleBtn">Search with Google AI</button>
                    </div>
                    
                    <div class="search-option">
                        <div class="search-option-header">
                            <div class="search-option-title">
                                <h4>Perplexity</h4>
                                <button class="option-info-btn" id="perplexityInfoBtn" aria-label="Perplexity search information">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M11,7H13V9H11V7M11,11H13V17H11V11Z"/>
                                    </svg>
                                </button>
                                <div class="option-info-tooltip" id="perplexityInfoTooltip">
                                    Search using Perplexity's AI research assistant with real-time citations
                                </div>
                            </div>
                        </div>
                        <button class="btn" id="searchPerplexityBtn">Search with Perplexity</button>
                    </div>
                </div>
                
            </div>
        </div>
    </div>


    <!-- Artifact Generation Modal -->
    <div class="modal" id="artifactGenerationModal" role="dialog" aria-labelledby="artifactGenerationModalTitle" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="artifactGenerationModalTitle">Generate Document</h3>
                <button class="close-btn" aria-label="Close generation modal">×</button>
            </div>
            <div class="modal-body">
                <p class="help-text">Generate a structured document from your current conversation using AI.</p>
                
                <div class="generation-options">
                    <div class="generation-option" onclick="generateArtifactFromConversation(currentConversation, 'summary')">
                        <div class="option-icon">📋</div>
                        <div class="option-info">
                            <h4>Summary Document</h4>
                            <p>Comprehensive summary with key points and decisions</p>
                        </div>
                    </div>
                    
                    <div class="generation-option" onclick="generateArtifactFromConversation(currentConversation, 'plan')">
                        <div class="option-icon">📈</div>
                        <div class="option-info">
                            <h4>Project Plan</h4>
                            <p>Structured plan with objectives, tasks, and timeline</p>
                        </div>
                    </div>
                    
                    <div class="generation-option" onclick="generateArtifactFromConversation(currentConversation, 'meeting')">
                        <div class="option-icon">👥</div>
                        <div class="option-info">
                            <h4>Meeting Notes</h4>
                            <p>Formatted notes with decisions and action items</p>
                        </div>
                    </div>
                    
                    <div class="generation-option" onclick="generateArtifactFromConversation(currentConversation, 'research')">
                        <div class="option-icon">🔬</div>
                        <div class="option-info">
                            <h4>Research Document</h4>
                            <p>Analysis of findings and insights from discussion</p>
                        </div>
                    </div>
                    
                    <div class="generation-option" onclick="generateArtifactFromConversation(currentConversation, 'report')">
                        <div class="option-icon">📊</div>
                        <div class="option-info">
                            <h4>Formal Report</h4>
                            <p>Professional report with executive summary</p>
                        </div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button class="btn secondary" onclick="closeModal('artifactGenerationModal')">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modular JavaScript files -->
    <!-- IMPORTANT: Core system files must be loaded first -->
    <script src="error-manager.js"></script>
    <script src="data-manager.js"></script>
    <script src="message-manager.js"></script>
    <script src="summarization-engine.js"></script>
    <script src="context-manager.js"></script>
    
    <!-- Essential Optimization Components -->
    <script src="cache-manager.js"></script>
    <script src="stream-manager.js"></script>
    <script src="memory-optimizer.js"></script>
    <script src="folio-switcher.js"></script>
    
    <!-- Infrastructure Systems -->
    <script src="security-utils.js"></script>
    <script src="logger.js"></script>
    
    <!-- Task Management System (Modular) -->
    <script src="task-extractor.js"></script>
    <script src="task-templates.js"></script>
    <script src="task-storage.js"></script>
    <script src="task-scheduler.js"></script>
    <script src="task-renderer.js"></script>
    <script src="task-manager.js"></script>
    
    <!-- Application files -->
    <script src="api.js"></script>
    <script src="storage.js"></script>
    <script src="ui.js"></script>
    <script src="folios.js"></script>
    <script src="chat.js"></script>
    <!-- ONNX Runtime System (replaced Ollama/WebLLM) -->
    <script src="main.js"></script>
</body>
</html>