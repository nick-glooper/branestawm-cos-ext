console.log("ğŸ” WORKER: Transformers.js worker starting (local build)...");let t=null,a=null,n=null,i=null;try{console.log("ğŸ” WORKER: Loading local transformers.js..."),importScripts("./transformers.min.js"),console.log("ğŸ” WORKER: Local transformers.js loaded successfully!")}catch(r){console.error("ğŸ” WORKER: Failed to load local transformers.js:",r),postMessage({type:"error",error:"Failed to load transformers.js: "+r.message})}self.addEventListener("message",async r=>{const{type:o,data:e}=r.data;console.log(`ğŸ” WORKER: Received message: ${o}`);try{if(o==="init"){console.log("ğŸ” WORKER: Initializing AI models...");const s=e.extensionBaseURL;console.log("ğŸ” WORKER: Extension base URL:",s),typeof Transformers<"u"&&Transformers.env&&(Transformers.env.backends.onnx.wasm.wasmPaths=s,console.log("ğŸ” WORKER: WASM paths configured for local loading"));try{postMessage({type:"status",message:"Loading classifier model...",progress:20}),console.log("ğŸ” WORKER: Loading classifier (The Scout)..."),t=await Transformers.pipeline("zero-shot-classification","Xenova/distilbert-base-uncased-mnli"),console.log("ğŸ” WORKER: Classifier loaded"),postMessage({type:"status",message:"Loading embedding model...",progress:40}),console.log("ğŸ” WORKER: Loading embedder (The Indexer)..."),a=await Transformers.pipeline("feature-extraction","Xenova/all-MiniLM-L6-v2"),console.log("ğŸ” WORKER: Embedder loaded"),postMessage({type:"status",message:"Loading NER model...",progress:60}),console.log("ğŸ” WORKER: Loading NER extractor (The Extractor)..."),n=await Transformers.pipeline("ner","Xenova/distilbert-base-multilingual-cased-ner-hrl"),console.log("ğŸ” WORKER: NER extractor loaded"),postMessage({type:"status",message:"Loading generative model...",progress:80}),console.log("ğŸ” WORKER: Loading generator (The Synthesizer)..."),i=await Transformers.pipeline("text-generation","Xenova/gemma-2b-it"),console.log("ğŸ” WORKER: Generator loaded"),postMessage({type:"init-complete",success:!0,progress:100}),console.log("ğŸ” WORKER: All AI models initialized successfully!")}catch(l){console.error("ğŸ” WORKER: Model initialization failed:",l),postMessage({type:"init-complete",success:!1,error:l.message})}}else if(o==="classify"){if(!t)throw new Error("Classifier not initialized");console.log("ğŸ” WORKER: Running classification...");const s=await t(e.text,e.labels);postMessage({type:"classify-result",id:e.id,result:s})}else if(o==="embed"){if(!a)throw new Error("Embedder not initialized");console.log("ğŸ” WORKER: Generating embedding...");const s=await a(e.text);postMessage({type:"embed-result",id:e.id,embedding:s.data})}else if(o==="extract_entities"){if(!n)throw new Error("NER extractor not initialized");console.log("ğŸ” WORKER: Extracting entities...");const s=await n(e.text);postMessage({type:"entities-result",id:e.id,entities:s})}else if(o==="generate"){if(!i)throw new Error("Generator not initialized");console.log("ğŸ” WORKER: Generating text...");const s=await i(e.prompt,{max_length:e.maxLength||100,temperature:e.temperature||.7,...e.options});postMessage({type:"generate-result",id:e.id,text:s[0].generated_text})}else console.log("ğŸ” WORKER: Unknown message type:",o)}catch(s){console.error("ğŸ” WORKER: Error processing message:",s),postMessage({type:"error",id:e==null?void 0:e.id,error:s.message})}});console.log("ğŸ” WORKER: Transformers.js worker ready for messages (local build)");
