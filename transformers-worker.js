console.log("ğŸ” WORKER: Transformers.js worker starting (local build)...");let a=null,l=null,n=null,i=null,o=null;self.addEventListener("message",async d=>{const{type:t,data:e}=d.data;console.log(`ğŸ” WORKER: Received message: ${t}`);try{if(t==="init"){console.log("ğŸ” WORKER: Initializing AI models...");const s=e.extensionBaseURL;console.log("ğŸ” WORKER: Extension base URL:",s);try{console.log("ğŸ” WORKER: Loading local transformers.js..."),o=await import(s+"transformers.js"),console.log("ğŸ” WORKER: Local transformers.js loaded successfully!")}catch(r){console.error("ğŸ” WORKER: Failed to load local transformers.js:",r),postMessage({type:"init-complete",success:!1,error:"Failed to load transformers.js: "+r.message});return}typeof o<"u"&&o.env&&(o.env.backends.onnx.wasm.wasmPaths=s,console.log("ğŸ” WORKER: WASM paths configured for local loading"));try{postMessage({type:"status",message:"Loading classifier model...",progress:20}),console.log("ğŸ” WORKER: Loading classifier (The Scout)..."),a=await o.pipeline("zero-shot-classification","Xenova/distilbert-base-uncased-mnli"),console.log("ğŸ” WORKER: Classifier loaded"),postMessage({type:"status",message:"Loading embedding model...",progress:40}),console.log("ğŸ” WORKER: Loading embedder (The Indexer)..."),l=await o.pipeline("feature-extraction","Xenova/all-MiniLM-L6-v2"),console.log("ğŸ” WORKER: Embedder loaded"),postMessage({type:"status",message:"Loading NER model...",progress:60}),console.log("ğŸ” WORKER: Loading NER extractor (The Extractor)..."),n=await o.pipeline("ner","Xenova/distilbert-base-multilingual-cased-ner-hrl"),console.log("ğŸ” WORKER: NER extractor loaded"),postMessage({type:"status",message:"Loading generative model...",progress:80}),console.log("ğŸ” WORKER: Loading generator (The Synthesizer)..."),i=await o.pipeline("text-generation","Xenova/gemma-2b-it"),console.log("ğŸ” WORKER: Generator loaded"),postMessage({type:"init-complete",success:!0,progress:100}),console.log("ğŸ” WORKER: All AI models initialized successfully!")}catch(r){console.error("ğŸ” WORKER: Model initialization failed:",r),postMessage({type:"init-complete",success:!1,error:r.message})}}else if(t==="classify"){if(!a)throw new Error("Classifier not initialized");console.log("ğŸ” WORKER: Running classification...");const s=await a(e.text,e.labels);postMessage({type:"classify-result",id:e.id,result:s})}else if(t==="embed"){if(!l)throw new Error("Embedder not initialized");console.log("ğŸ” WORKER: Generating embedding...");const s=await l(e.text);postMessage({type:"embed-result",id:e.id,embedding:s.data})}else if(t==="extract_entities"){if(!n)throw new Error("NER extractor not initialized");console.log("ğŸ” WORKER: Extracting entities...");const s=await n(e.text);postMessage({type:"entities-result",id:e.id,entities:s})}else if(t==="generate"){if(!i)throw new Error("Generator not initialized");console.log("ğŸ” WORKER: Generating text...");const s=await i(e.prompt,{max_length:e.maxLength||100,temperature:e.temperature||.7,...e.options});postMessage({type:"generate-result",id:e.id,text:s[0].generated_text})}else console.log("ğŸ” WORKER: Unknown message type:",t)}catch(s){console.error("ğŸ” WORKER: Error processing message:",s),postMessage({type:"error",id:e==null?void 0:e.id,error:s.message})}});console.log("ğŸ” WORKER: Transformers.js worker ready for messages (local build)");
